## Network > Load Balancer > コンソール使用ガイド

## ロードバランサー管理

### ロードバランサー作成
NHN Cloudコンソールでロードバランサーの設定値を入力するだけで、簡単にロードバランサーを作成できます。目的に応じてL4ルーティングとL7ルーティングのいずれかのモードを選択して作成できます。<br>
モードはテンプレートを意味するだけで、実際のロードバランサーのタイプとして指定されるわけではありません。 L4ルーティングモードでロードバランサーを作成し、L7ルールを追加できます。

* L4ルーティング: IPとポートに基づいて負荷分散を行うロードバランサーです。作成後、L7ルールを追加してLayer7ロードバランサーに変更できます。
* L7ルーティング: L7データに基づいて負荷分散を実行するロードバランサーです。

#### ロードバランサー設定
ロードバランサーの基本情報を設定します。必要な項目は次のとおりです。

* 名前：ロードバランサーの名前を入力します。
* 説明：ロードバランサーの説明を記述します。
* タイプ：一般、または専用のいずれかを選択できます。
* VPC、サブネット：ロードバランサーが接続されるVPCのサブネットを指定します。
* サブネット静的ルート：ロードバランサーが位置するサブネットの静的ルート設定をロードバランサーに適用するかどうかを選択します。**自動割り当て**を選択すると、サブネット範囲内で使用可能なプライベートIPを割り当てられ、ロードバランサーに付与されます。**指定**を選択すると、希望するプライベートIPをロードバランサーに付与できます。

#### リスナー設定
ロードバランサーが処理するトラフィックの属性を定義します。NHN Cloudのロードバランサーは、1つ以上のリスナーを持つことができます。

* 名前：リスナーの名前を入力します。
* 説明：リスナーの説明を記述します。
* プロトコル：ロードバランサーが処理するトラフィックのプロトコルを指定します。 TCP/HTTP/HTTPS/TERMINATED_HTTPSの中から1つを選択します。
* ロードバランサーポート：基本リスナーがトラフィックを受信するポートを指定します。
* 基本メンバーグループ：トラフィックの受信時に基本的に分配されるメンバーグループを指定します。リスナーの基本メンバーグループを**使用しない**に指定できます。L7ルールがない場合や、L7ルールがあっても条件に合致せず、**使用しない**でロードバランシングを決定した場合、そのリクエストは503を返します。
* 接続制限：基本リスナーが同時に維持するTCPセッションの数を指定します。一般ロードバランサーは最大60,000まで、専用ロードバランサーは最大480,000まで設定できます。
* Keep-Aliveタイムアウト：クライアントとサーバーとのセッション維持時間を秒単位で指定します。ロードバランサーは、相手がセッションを維持している限り、この時間だけセッションを維持します。サーバーに設定したKeep-Aliveタイムアウト値をここに設定することを推奨します。デフォルトは300秒に設定されています。
* プロキシプロトコル：ロードバランサーにプロキシプロトコルをサポートさせることができます。サーバーでクライアントのIPを知るためにプロキシプロトコルを使用する場合のみ、この値を有効にする必要があります。TCPとHTTPSプロトコルを使用する場合にのみ利用できます。
* 無効なリクエストをブロック：**使用しない**を選択すると、HTTPリクエストヘッダに無効な文字が含まれている場合、ブロックします。HTTPとTERMINATED_HTTPSプロトコルを使用する場合にのみ利用できます。

* SSL証明書：プロトコルとしてTERMINATED_HTTPSを選択した場合、使用する証明書を登録します。

> [注意]ロードバランサーポート及びプロトコルはリスナー作成後に変更できません。

> [注意]リスナーの基本メンバーグループを**使用しない**に指定できます。L7ルールがない場合や、L7ルールがあっても条件に合致しないため、**使用しない**でロードバランシングを決定した場合、そのリクエストは503を返します。

> [参考]ロードバランサーポートは、1から65535の間の値を持ちます。

> [参考]メンバーグループがリスナーの基本メンバーグループに属しているか、L7ルールの作業対象として指定された場合のみ状態確認を行います。それ以外の場合は、そのメンバーグループでは状態確認を行いません。

> [参考] TERMINATED_HTTPS証明書の登録方法
>
> ロードバランサーのリスナープロトコルをTERMINATED_HTTPSに指定した場合、SSL証明書を登録するボタンが有効になります。
>
> 登録する必要があるファイルは、‘証明書’と‘秘密鍵’です。‘秘密鍵’はサーバー証明書に含まれている公開鍵のペアになる秘密鍵を意味します。
>
> ‘証明書’は下記のようにx.509 PEM形式に従います。
>
>     -----BEGIN CERTIFICATE-----
>     (内容省略)
>     -----END CERTIFICATE-----
>
>
> サーバー証明書と中間証明書(Chain Certificate, Intermediate Certificate)を一緒に登録する必要がある時は、サーバー証明書と中間証明書を1つのファイルで作って登録する必要があります。
>
> 証明書ファイルを1つで作る時は、ファイルの最上段にサーバー証明書を記述し、その下に中間証明書を記述する必要があります。中間証明書は順序に関係なく記述できます。
>
>サーバー証明書1個と中間証明書2個を1つの証明書ファイルで作ると次のような形式になります。
>
>
>      -----BEGIN CERTIFICATE-----
>      (サーバー証明書の内容省略)
>      -----END CERTIFICATE-----
>      -----BEGIN CERTIFICATE-----
>      (中間証明書#1内容省略)
>      -----END CERTIFICATE-----
>      -----BEGIN CERTIFICATE-----
>      (中間証明書#2内容省略)
>      -----END CERTIFICATE-----
>
>
>
> ‘秘密鍵’は、サーバー証明書に含まれている公開鍵に対応する鍵ファイルです。
>
> PKCS#1またはPKCS#8 PEM形式のファイルを登録できます。
>
>
>
>      -----BEGIN RSA PRIVATE KEY-----
>      (秘密鍵の内容省略)
>      -----END RSA PRIVATE KEY-----
>
>または
>
>      -----BEGIN PRIVATE KEY-----
>      (秘密鍵の内容省略)
>      -----END PRIVATE KEY-----

##### Certificate Manager使用
リスナーでTERMINATED_HTTPSプロトコルを使用する場合、証明書の登録はCertificate Managerに登録した証明書を使用する方法と、直接登録する方法の2つがあります。

* Certificate Managerサービスに証明書を登録し、リスナーに証明書を接続すると、証明書の有効期限のアラームをメールで受信できます。
* リスナーに直接証明書を登録した場合は、証明書の有効期限のアラームがありません。(コンソールのリスナー画面で有効期限を確認できます)
> [注意事項]
> Certificate Managerサービスで証明書を更新した場合、影響を受けるリスナーの証明書も更新する必要があります。
> Certificate Managerに登録した証明書をリスナーに使用するには、「秘密鍵」のパスワードが除去されている必要があります。そしてPKCS#1またはPKCS#8 PEM形式にする必要があります。


##### L7ルール設定
ロードバランサーは、L7データに基づいてロードバランシングを行うことができます。L7ルーティングテンプレートを選択してロードバランサーを作成する場合、L7ポリシーを含むロードバランサーを作成できます。L7ポリシーは、リスナーのプロトコルがHTTP/TERMINATED_HTTPSの場合のみ正常に動作します。L4テンプレートでロードバランサーを作成しても、後日、L7ルールを追加できます。

* 名前：L7ルールの名前を入力します。
* 説明：L7ルールの説明を記述します。
* 作業タイプ: L7ルールマッチング時に実行するアクションを指定します。
  * メンバーグループへの転送：L7ルールにマッチした場合、設定されたメンバーグループに送信する方法です。L7データに基づいて特定のメンバーグループにパケットをルーティングできます。
  * URLへの転送: L7ルールにマッチする場合、設定されたURLにリダイレクトする機能です。HTTPヘッダのLocationを使用してリダイレクトを実行します。
    * **URLで伝達**の場合、Redirect URLを細かく設定できます。プロトコル、ポート、ホスト、パス、クエリそれぞれについて値を維持したり、直接変更してリダイレクトできます。詳細は下記の[参考]をご確認ください。
    * ステータスコード:リダイレクト時にロードバランサーがレスポンスするHTTPレスポンスコードです。 301と302をサポートします。  
  * ブロック：L7ルールにマッチした場合、ブロックする機能です。Forbidden (403)でレスポンスを返します。
* 作業対象：作業タイプに応じた適用対象を設定します。作業タイプによって入力方法が異なります。
* 作業の優先順位：L7ルールの優先順位を設定します。入力した値に基づいて作業タイプ内の優先順位が決定され、重複した値を入力した場合、新しいルールが優先されます。
  * ルール適用順序は、**ブロック**、**URLに転送**、**メンバーグループに転送**の順です。同じ作業タイプ内では、ユーザーが入力した優先順位を適用します。
  * L7ルール表の**ルール適用順序**列を通して、ルールの実際の適用順序を簡単に把握できます。
  * L7ルールを追加または変更するたびに、ユーザーが入力した作業の優先順位は、内部的に並べ替えて優先順位を再決定します。
  * **詳細表示**で確認できる作業優先順位は、ユーザーが入力した絶対値ではなく、内部的に再配置された優先順位の相対値を表現します。
  * 後日、L7ルールを追加または変更したい場合は、内部で再整列された優先順位の相対値を基準に優先順位を設定する必要があります。
* 条件：L7ルールに適用する条件を記述します。条件はL7ルールごとに10個まで作成できます。
  * 条件タイプ：条件タイプは、パス、ヘッダ、ファイルタイプ、Cookie、そしてホスト名をサポートします。
    * パス： URLパスの値を検査します。
    * ヘッダ： HTTPヘッダに含まれるフィールドを検査します。ヘッダフィールド名を追加で入力する必要があります。
    * ファイルタイプ: URLパスの末尾の値を検査します。拡張子をマッチさせるのに便利です。
    * Cookie：HTTPリクエストヘッダのCookieフィールドを検査します。Cookieのキーを追加で入力する必要があります。
    * ホスト名：HTTPリクエストヘッダのホストフィールドを検査します。
  * 比較方式：比較方式は、条件タイプによってCONTAINS/EQUAL_TO/STARTS_WITH/ENDS_WITH/REGEXの中から選択できます。
    * CONTAINS：条件タイプの文字列が入力した値を含んでいる場合、trueです。
    * EQUAL_TO:条件タイプの文字列が入力した値と一致する場合、trueです。
    * STARTS_WITH:条件タイプの文字列が入力した値から始まる場合、trueです。
    * ENDS_WITH:条件タイプの文字列が入力した値で終わる場合、trueです。
    * REGEX:条件タイプの文字列が入力した正規表現文法に合致する場合、trueです。
  * 値:マッチングしたい文字列を入力します。条件タイプがヘッダまたはCookieの場合は、keyを追加で入力する必要があります。

> [注意]条件タイプのうち、ホスト名は大文字と小文字を区別しません。
> [参考]設定したL7ルールにマッチしない場合、トラフィックはリスナーの基本メンバーグループに転送されます。
> [参考]メンバーグループがリスナーの基本メンバーグループに属しているか、L7ルールの作業対象として指定された場合のみ状態確認を行います。それ以外の場合は、そのメンバーグループでは状態確認を行いません。
> [参考]メンバーグループが削除された場合、そのメンバーグループを作業対象としていたL7ルールは、作業タイプがブロックに変更されます。

> [参考] L7ルールで**URLで伝達**に設定した場合、リダイレクトするURLの一部の値を維持するか直接指定できます。もし特定フィールドの値を維持したい場合、各URI部分設定フィールドに`#{protocol}`, `#{port}`, `#{host}`, `#{path}`, `#{query}`のような形で入力します。例えば、HTTPに流入したリクエストに対してプロトコルとポート番号のみHTTPS及び443ポートに変更したい場合、プロトコルは`HTTPS`、ポートは`443`、ホストは`#{host}`、パスは`#{path}`、クエリは`#{query}`と入力します。

#### メンバーグループ設定
ロードバランシングトラフィックを転送する対象メンバーグループを設定します。メンバーグループは、ロードバランサーの作成が完了した後も追加で作成できます。

* 名前：メンバーグループの名前を入力します。
* 説明：メンバーグループの説明を記述します。
* プロトコル：メンバーグループが処理するトラフィックのプロトコルを指定します。HTTP/HTTPS/TCPのいずれかを選択します。
* メンバーポート：メンバーグループがトラフィックを受信するポートを指定します。
* ロードバランシング方式：ロードバランサーがトラフィックを分散する方法を決定します。ROUND_ROBIN/LEAST_CONNECTIONS/SOURCE_IPのいずれかを選択します。
* セッションの永続性：セッションを維持するために、リクエストに対するレスポンスを特定のインスタンスでのみ行うようにする設定です。セッション永続性なし/APP_COOKIE/HTTP_COOKIE/SOURCE_IPのいずれかを選択できます。


> [注意]メンバーポート及びプロトコルはメンバーグループ作成後に変更できません。
> [参考]メンバーポートは1から65535の間の値を持ちます。


##### ヘルスチェック

状態確認のための設定もメンバーグループ作成時に決定します。NHN Cloudのロードバランサーは、メンバーグループごとに状態確認動作を定義できます。必要な項目は以下の通りです。

* ヘルスチェックプロトコル：ヘルスチェック時に使用するプロトコルを決定します。TCP/HTTP/HTTPSの中から1つを選択します。
* 状態確認ポート：状態確認を試みるメンバーのポートを設定します。メンバーポートを選択すると、各メンバーに指定されたポート番号に状態確認を行います。ユーザー指定を選択すると、各メンバーのポート番号に関係なく、一括でユーザー指定ポート番号に対して状態確認を行います。
* HTTPメソッド：状態確認時に使用するHTTPメソッドを選択します。状態確認プロトコルとしてHTTPまたはHTTPSを選択した場合のみ有効になります。現在はGETのみをサポートしています。
* HTTPステータスコード：状態確認時に正常レスポンスとみなすHTTPステータスコードを入力します。状態確認プロトコルとしてHTTPまたはHTTPSを選択した場合のみ有効になります。現在、GETのみをサポートしています。
* URL:状態確認を試みるメンバーのパスを指定します。状態確認プロトコルとしてHTTPまたはHTTPSを選択した場合のみ有効になります。
* ヘルスチェックの周期：ヘルスチェックを行う周期を入力します。単位は秒で、指定された周期ごとにヘルスチェックを行います。
* 最大レスポンス待機時間：ヘルスチェック後、正常レスポンスを待機する最大時間を指定します。単位は秒で、指定された待機時間を超えると失敗とみなします。ヘルスチェック
* 最大再試行回数：ヘルスチェック時に繰り返し試行する最大回数を指定します。最大再試行回数が2以上の場合、ヘルスチェックに対する正常レスポンスがなかったからといって、すぐに失敗とはみなしません。失敗した回数が最大再試行回数に達した場合、そのインスタンスを負荷分散対象から除外します。
* ホストヘッダ：ヘルスチェック時にホストヘッダで使用するフィールド値を入力します。ヘルスチェックプロトコルにHTTPまたはHTTPSを選択したときのみ有効になります。

最後に接続に関する設定を指定します。

* セッション持続性：セッションを維持するため、リクエストに対するレスポンスを特定インスタンスでのみ行うように作成する設定です。 No Session Persistence/ APP_COOKIE/ HTTP_COOKIE/ SOURCE_IPの中から1つを選択できます。
* 接続制限：基本リスナーが同時に維持するTCP接続の数を指定します。値を入力していない場合、基本値の2000に設定されます。
* Keepalive  タイムアウト：クライアント及びサーバーとのセッション維持時間を秒単位で指定します。ロードバランサーは、相手側がセッションを維持する限り、この時間の間はセッションを維持します。インスタンスに設定したkeepalive timeoutの値をここに設定することを推奨します。基本値は300秒に設定されます。
* プロキシプロトコル：ロードバランサーがプロキシプロトコルをサポートするようにできます。インスタンスでクライアントのIPを知るためにプロキシプロトコルを使用するように設定した場合にのみ、この値を有効にする必要があります。TCPとHTTPSプロトコルを使用する場合にのみ利用できます。

> [参考]メンバーグループがリスナーの基本メンバーグループに属しているか、L7ルールの作業対象として指定された場合のみ、状態確認を実行します。それ以外の場合は、そのメンバーグループでは状態確認を実行しません。

##### メンバー設定
ロードバランサー作成時にメンバーとして登録するインスタンスまたはIPを指定します。メンバー登録はロードバランサーの作成後にも行うことができます。メンバーは二つの方法で登録できます。

* インスタンス：ロードバランサーが接続されたVPCおよびそのVPCとピアリングされたVPCに属するインスタンスをメンバーとして追加できます。ただし、ロードバランサーとサブネットが異なるインスタンスをメンバーとして登録するには、ルーティングテーブルに二つのサブネットを登録する必要があります。
* IPアドレス: IPを直接入力してメンバーを登録できます。この場合、ロードバランサーと当該IPの通信経路が適切に設定されている必要があります。

#### 削除保護
削除保護を有効にすると、誤って削除されないようにロードバランサーを保護できます。削除保護を無効にするまでそのロードバランサーを削除することはできません。削除保護を設定したロードバランサーはリスナー、メンバーグループ、L7ルールを削除できません。削除保護を設定したロードバランサーはヘルスモニターを削除および変更できません。

#### IPアクセス制御グループ
ロードバランサー作成時に適用するIPアクセス制御グループを指定します。 IPアクセス制御グループの中から、同じアクセス制御タイプを持つ複数のグループを選択できます。ロードバランサー作成後も、適用するIPアクセス制御グループを変更できます。

### ロードバランサーの詳細確認
ロードバランサーの作成を終えたら、再びロードバランサーリスト画面に戻ります。ロードバランサーリスト画面では作成されたロードバランサーの基本情報を確認できます。リスト画面に表示される項目は次のとおりです。

* 名前：ロードバランサー作成時に指定したロードバランサーの名前です。
* タイプ：ロードバランサーのタイプです。
* IPアドレス：ロードバランサーに接続されたVPCから割り当てられたプライベートIPです。VPC内部では、このIPを通じてロードバランサーにアクセスできます。VPC外部からロードバランサーにアクセスするためには、フローティングIPを接続する必要があります。
* ネットワーク：ロードバランサーに接続されたVPCの名前とサブネットCIDRです。
* 状態:ロードバランサーの作成状態を示します。ACTIVEと表記されている場合は、正常に作成されたものです。
* ロードバランサーの詳細：ロードバランサーに接続されたリスナーとメンバーグループの詳細を確認できます。

> [参考]ロードバランサーの作成状態は次の中から1つが決定されます。

> | 状態 | 意味 |
> |--|--|
> | ACTIVE | ロードバランサー作成完了、正常動作中 |
> | PENDING_CREATE | ロードバランサー作成中 |
> | PENDING_UPDATE | ロードバランサーの設定修正中<br> 設定修正後、1時間以内にACTIVE状態に変わらない場合は、管理者にお問い合わせください。|
> | PENDING_DELETE | ロードバランサー削除中<br> 削除後、1時間以内にリストから消えない場合は、管理者にお問い合わせください。|
> | ERROR | ロードバランサー作成失敗 <br> 管理者にお問い合わせください。 |
> | ERROR_MIGRATE | ロードバランサー移行失敗<br> 管理者にお問い合わせください。 |


### ロードバランサーの修正および基本情報
ロードバランサーリスト画面で目的のロードバランサーを選択すると、画面下部に選択したロードバランサーの追加情報が表示されます。詳細画面は2つのタブに分かれています。各タブの説明は以下の通りです。

* 基本情報:選択したロードバランサーの追加基本情報を表示します。選択したロードバランサーの名前と説明、サブネット静的ルートの適用有無を変更できます。
* 統計：選択したロードバランサーの統計情報を確認できます。

> [参考]ロードバランサーが接続されたVPCとIPアドレスは変更できません。

### リスナーの変更と詳細情報
ロードバランサーの基本画面で目的のロードバランサーの詳細表示を選択すると、ロードバランサーに接続されたリスナーとメンバーグループを確認できます。このうち、**リスナー**タブを選択してリスナーを作成、変更、削除できます。

#### リスナーの作成
**リスナーの作成**をクリックすると、リスナーを追加で作成できます。リスナーの追加に必要な項目は、ロードバランサーの作成時、基本リスナーで必要な項目と同じです。リスナーを追加する際、既存のリスナーが使用していたロードバランサーポートは使用できません。

#### リスナーの変更
変更するリスナーで**リスナーの変更**をクリックすると、リスナーの設定を変更できます。

> [注意]リスナーのポートとプロトコルは変更できません。

#### リスナーの削除
削除するリスナーで**リスナーの削除**をクリックすると、そのリスナーは削除されます。

> [注意]リスナーの作成/修正/削除時にロードバランサーが再起動されます。再起動する過程で、既存の接続されたセッションは維持されますが、新しいセッションは処理できません(約1秒未満)。したがって、サービスに影響を与えない時間に行うことを推奨します。

### メンバーグループの変更と詳細情報
ロードバランサー画面で目的のロードバランサーの**詳細表示**を選択すると、ロードバランサーに接続されたリスナーとメンバーグループを確認できます。このうち、**メンバーグループ**タブを選択し、メンバーグループの作成、変更、削除を行うことができます。

#### メンバーグループの作成
**メンバーグループ作成**をクリックすると、メンバーグループを追加で作成できます。メンバーグループの作成に必要な項目は、ロードバランサーの作成時にメンバーグループで必要な項目と同じです。

#### メンバーグループの変更
**メンバーグループの変更**をクリックすると、メンバーグループに関する設定を変更できます。

> [注意]メンバーポート及びプロトコルはメンバーグループ作成後に変更することはできません。

#### メンバーグループの削除
削除するメンバーグループを選択し、**メンバーグループ削除**をクリックすると、そのメンバーグループは削除されます。

> [注意]メンバーグループを作成/修正/削除すると、ロードバランサーが再起動されます。再起動する過程で、既存の接続されたセッションは維持されますが、新しいセッションは処理できません(約1秒未満)。そのため、サービスに影響を与えない時間に行うことを推奨します。

> [参考]メンバーグループが削除された場合、そのメンバーグループを作業対象としていたL7ルールは、作業タイプがブロックに変更されます。

### メンバーの変更及び詳細情報
ロードバランサー**詳細表示**画面で**メンバーグループ**タブを選択した後、希望するメンバーグループを選択すると、メンバーグループの詳細情報及びメンバーグループに属するメンバーの状態を確認できます。

#### メンバーの追加
メンバーグループを選択すると、画面下部に**基本情報**、**メンバー**、**状態確認** タブが表示されます。**メンバー** タブを選択し、任意のインスタンスまたはIPアドレスをメンバーとして登録できます。インスタンスの追加は、ロードバランサーが接続されたVPC及び該当VPCにピアリングされたVPCに属するインスタンスのみ可能です。メンバーごとに宛先ポート番号を直接指定することができ、該当宛先ポート番号でロードバランシングが行われます。

> [注意]メンバーグループ内にポート番号だけが異なるメンバーが複数存在する場合、状態確認ポート設定に注意する必要があります。例えば、 192.168.0.10の80ポート、 192.168.0.10の8080ポートのように2つのメンバーが存在すると仮定すると、状態確認ポートをメンバーポートとして選択すると、80ポート及び8080ポートそれぞれを対象に状態確認を行います。もし状態確認ポートをユーザー指定に選択した後、80を入力すると、メンバーポートが8080ポートであっても80ポートを確認します。もし192.168.0.10の80ポートが有効になっている場合、192.168.0.10の8080ポートのメンバーも192.168.0.10の80ポートの状態を確認するために、ACTIVE状態とみなします。

#### メンバーの無効化
特定のメンバーを一時的にサービスから除外できます。除外するメンバーを選択し、**メンバー無効化**ボタンをクリックした後、**確認**をクリックします。
除外されたメンバーの使用項目は**X**、メンバーの状態は**ONLINE**に変更されます。

> [参考]メンバーの状態は、次のいずれかの状態になります。
> 
> | 状態 | 意味 |
> |--|--|
> | ACTIVE | メンバー接続完了、正常動作中 |
> | INACTIVE | メンバーの状態確認が実行されていない状態 |
> | ONLINE | メンバーが無効化されている状態|
> | OFFLINE | メンバー接続失敗 <br> 管理者にお問い合わせください。|

#### メンバーの削除
使用しなくなったメンバーは削除できます。削除するメンバーを選択し、**メンバー削除**をクリックすると削除されます。ロードバランサーのメンバーを削除しても、インスタンスは削除されません。

> [注意]メンバーを追加/無効化/削除すると、ロードバランサーが再起動されます。再起動する過程で、既存の接続されたセッションは維持されますが、新しいセッションは処理できません(約1秒未満)。したがって、サービスに影響を与えない時間に行うことを推奨します。

> [注意]メンバーの追加/無効化/削除時にロードバランサーが再起動します。再起動する過程で接続済みのセッションは維持されますが、新しいセッションは処理できません(約1秒未満)。したがって、サービスに影響を与えない時間に進行することを推奨します。

### ロードバランサーの削除
ロードバランサーのリスト画面で、削除したいロードバランサーを選択した後に削除ボタンを押すと、そのロードバランサーが削除されます。

## IPアクセス制御グループ
IPアクセス制御機能の詳細は、[IPアクセス制御](/Network/Load%20Balancer/ja/overview/#ip)を参照してください。

#### IPアクセス制御グループの作成
IPアクセス制御グループを作成するために、アクセス制御グループ作成ボタンを押し、次の値を入力します。

* 名前：アクセス制御グループの名前を入力します。
* 説明：アクセス制御グループの説明を入力します。
* IPアクセス制御タイプ：遮断または許可のどちらかを選択します。
* IPアクセス制御対象の追加：アクセス制御対象になるIPと説明を入力します。右にある"+"ボタンを押し、複数のアクセス制御対象を一度に追加できます。多くの対象を簡単に入力するには、"大量入力"を選択します。この場合、1行に"IPアドレスまたはCIDR"と"説明"を入力します。一度に最大100個のアクセス制御対象を入力できます。


確認を押すと、アクセス制御グループと対象が作成されます。

> [参考] IPアクセス制御グループとIPアクセス制御対象の数
> 
> プロジェクトごとにアクセス制御グループを最大10個まで作成できます。
> プロジェクトごとにアクセス制御対象を最大1,000個まで作成できます。


#### IPアクセス制御グループの変更
IPアクセス制御グループのプロパティを変更できます。変更可能なプロパティは名前と説明です。"IPアクセス制御タイプ"プロパティは変更できません。

#### IPアクセス制御グループの削除
選択したIPアクセス制御グループを削除できます。グループを削除すると、グループに属するすべてのアクセス制御対象も削除されます。
IPアクセス制御グループを削除すると、このグループを使用するロードバランサーが該当ポリシーを使用しなくなります。

#### IPアクセス制御対象の追加
アクセス制御グループを選択すると、下部にアクセス制御対象メニューが表示されます。
アクセス制御グループに対象を追加すると、このアクセス制御グループを使用するすべてのロードバランサーに追加されたIPまたはCIDRにポリシーが反映されます。

#### IPアクセス制御対象の変更
アクセス制御対象のプロパティを変更できます。説明のみ変更できます。

#### IPアクセス制御対象の削除
アクセス制御グループを選択すると、下部にアクセス制御対象メニューが表示されます。
アクセス制御グループに属する対象を削除すると、このアクセス制御グループを使用するすべてのロードバランサーに、該当IPまたはCIDRのポリシーが削除されます。

#### IPアクセス制御グループの適用
IPアクセス制御グループを適用するロードバランサーを選択します。該当ロードバランサーに設定するグループを選択し、確認を押します。
"アクセス制御タイプ"が同じ複数のグループをロードバランサーに適用できます。

## 機器のメンテナンスのためのロードバランサー再起動ガイド

NHN Cloudは周期的にロードバランサーのソフトウェアをアップデートして、基本インフラサービスのセキュリティと安定性を向上させています。ロードバランサーのメンテナンスのためにメンテナンス対象機器で起動中のロードバランサーは再起動を行い、メンテナンスが完了したロードバランサーに移動する必要があります。

再起動が必要なロードバランサーは名前の横に**!再起動**ボタンが表示され、このボタンを使用して再起動できます。

メンテナンス対象に指定されたロードバランサーがあるプロジェクトに移動して、次の手順で再起動を行います。

1. メンテナンス対象ロードバランサーを確認します。
  ロードバランサー名の横に**!再起動**ボタンがあるロードバランサーが、メンテナンス対象のロードバランサーです。
   ![image-001](http://static.toastoven.net/prod_load_balancer/lb_p_migration_jp_1.png)
    **!再起動**ボタンにマウスオーバーすると、詳しいメンテナンス日程を確認できます。サービスに影響を与えない時間に実行してください。
   ![image-002](http://static.toastoven.net/prod_load_balancer/lb_p_migration_jp_2.png)
2. メンテナンス対象ロードバランサーを選択し、名前の横にある**!再起動**ボタンをクリックします。
3. ロードバランサーの再起動を確認するウィンドウが表示されたら、**確認**ボタンをクリックします。
   ![image-003](http://static.toastoven.net/prod_load_balancer/lb_p_migration_jp_3.png)
4. 状態表示灯が緑色に変わり、**!再起動**ボタンが消えるまで待機します。
  ロードバランサーの状態表示灯が変わらなかったり、**!再起動**ボタンが消えない場合は、「更新」を実行してみてください。
   ![image-004](http://static.toastoven.net/prod_load_balancer/lb_p_migration_jp_4.png)

ロードバランサーの再起動中は、該当ロードバランサーで何も操作ができません。
ロードバランサーの再起動が正常に完了しない場合は、自動的に管理者に報告され、NHN Cloudから別途連絡いたします。

## 物理ロードバランサーと一般的なロードバランサーの違い
2021年4月にオンラインリリースされた物理ロードバランサーは、既存のロードバランサー商品(一般/専用)と比較して次のような違いがあります。

* 物理ロードバランサーは韓国ピョンチョンリージョンでのみ提供されます。
* 物理ロードバランサーにはFloating IPを接続することはできません。物理ロードバランサーの作成時に自動的に割り当てられたパブリックIPをバランシング対象トラフィックを受信するIPとして使用します。このパブリックIPは、サービスIPという名前でコンソールに表示されます。
* サブネットに使用されていない連続したIPが17個存在する場合に、物理Basicロードバランサーを作成できます。この17個のIPは物理ロードバランサーに割り当てられ、予約IPという名前でWebコンソールに表示されます。
* 物理Premiumロードバランサーを作成するには、サブネットに未使用の連続したIPが50個存在する必要があります。この50個のIPは物理ロードバランサーに割り当てられ、予約IPという名前でWebコンソールに表示されます。
* 物理ロードバランサーはProxy Protocol機能を提供しません。
* 物理ロードバランサーはロードバランサー統計機能を提供しません。
* 物理ロードバランサーはロードバランサーIPアクセス制御機能を提供しません。
